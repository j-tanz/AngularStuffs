Lesson Plan: 10.2

Open the [slidedeck](https://docs.google.com/presentation/d/1RwUmE0lqkTHtaKUHfWfhxvF3VweuvP2ipnxlLoGfLu4/edit?usp=sharing) for this lesson.

## Angular Routing Basics (45 minutes)

Video walkthrough: https://youtu.be/g3yr7cRVOZM

### The Why ( 5 min )

Many web applications will use routing in some form. Angular employs a SPA (Single Page Application) architecture, where the `index.html` is simply the only page that's loaded, but navigation can still happen within the application.

#### Demo

* Demo the E-Commerce app with routing

**Prep:**

<details style='background: #ddd;'>
  <summary> Read the Angular primer on SPAs for good points regarding "Why?"</summary> 
  https://blog.angular-university.io/why-a-single-page-application-what-are-the-benefits-what-is-a-spa/
  
</details>

### Instructor Do: App Routing Module ( 15 min )

File(s): `02-activities/`

* Refer to and send out the Angular routing documentation: https://angular.io/guide/router

  * Recommended: Refer to and pull up the documentation when going through the router pieces, as the topic can be quite complex, and pointing to where you're getting information from will be helpful to the students
  
* (Note that the `<base href="/">` must be present in `index.html`)

* Walk through the major pieces of the `AppRoutingModule`

  * `app-routing.module.ts` is auto-generated by the CLI, if selected. It's almost always a good idea to generate it, unless you know your app will intentionally be small and not use/need routing

  * It similarly uses an `@NgModule` decorator with and `imports` and `exports` array. For now, these properties won't be adjusted

  * Important: The main changes to an app's routing structure will be through the `const routes` array.

* Walk through the key parts of a `routes` [configuration](https://angular.io/guide/router#configuration).

  * For a basic route, a `path` and `component` property is used. When the path is navigated to, the component renders

  * Demonstrate one of these by creating a path (string) that navigates to a component. This won't work yet though, because there is no `<router-outlet>`

```ts
// app-routing.module.ts

import { ItemsMasterComponent } from './items-master/items-master.component';

const routes: Routes = [
  { path: 'items', component: ItemsMasterComponent },
];
```

  * **Important**: Discuss how a beginning `/` refers to an *absolute* route, while no slash indicates a *relative* route

* Discuss (router outlet)[https://angular.io/guide/router#router-outlet] and how Angular determines *where* to render the routing by "filling in" the `<router-outlet>` HTML tag.

  * Put the `<router-outlet>` tag in the `app.component.html` so the file now only has the following code:

```html
<app-navbar></app-navbar>
<hr>
<router-outlet></router-outlet>
```

  * This allows us to still render a navbar, but the rest of the routes are rendered where we tell Angular to render it.

### Partners Do: Set Up Basic Routing ( 10-15 min )

File(s): `02-activities/02-stu_routing/README.md`

* Ensure an `app-routing.module.ts` is created via the CLI

* Ensure a `<base href="/">` is present in the `index.html` head

* Add a `Route` object to the `routes` in `app-routing.module.ts` with a `path: 'items'` and a `component: ItemsMasterComponent`

* Add a `Route` object to the `routes` in `app-routing.module.ts` with a `path: 'admin'` and a `component: AdminComponent`

* Add the `<router-outlet></router-outlet>` to the `app.component.html`

### Instructor Review: Brief Recap( 5 min )

File(s): `02-activities/02-stu_routing/solved`

* Recap how we added our routes

---

## Break (5 mins)

---

### Instructor Do: Empty/Default Routes and WildCard Routes ( 10 min )

File(s): `02-activities/03-inst_default_routes`

* Discuss empty/default routes, which can be implemented with:

```ts
 { path: '', redirectTo: 'items', pathMatch: 'full' }
```

  * This is used for when the url is empty, such as just `localhost:4200` (or analogously just `google.com` with nothing afterward).

  * Add the above empty path and demonstrate how the app reroutes to the `items` route when on the base path

  * `pathMatch` *must* be added or else there will be an error. `full` will most commonly be used, but `prefix` is another option (no need to go in depth here; just have them use `full`)

* Generate a `PageNotFoundComponent` quickly via the CLI (no need to adjust it; just ensure it's declared in the `AppModule`), and add a Not Found route via a `**` wildcard:

```
ng g c shared/page-not-found
```

```ts
{ path: '**', component: PageNotFoundComponent }
```

  * Demonstrate how typing in non-declared route will go to the Not Found component (it should just show `PageNotFoundComponent works!` as the boilerpalte)

## Students Do: Add Empty/Default and WildCard Routes (10-15 minutes)

File(s): `02-activities/04-stu_default_routes/README.md`

Instructions:

1. Inside of `app-routing.module.ts`, create a path to ``, that redirects to `items`, and ensure that you also set pathMatch to `full`.

1. Generate a new component, page-not-found, and create a new path to `**` that redirects to `PageNotFoundComponent`.

Hint: Don't forget to import components!

### Instructor Review: Brief Recap( 5 min )

File(s): `02-activities/04-stu_default_routes/solved`

### Instructor Do: `routerLink`s in the `NavbarComponent` ( 10 min )

File(s): `02-activities/05-inst_router_links`

* Refer to and send out: https://angular.io/guide/router#router-links

* Discuss `routerLink`s

  * We still use an `<a>` anchor tag, but we *do not use `href`*.

  * Instead, we use a `routerLink` directives

  * Demonstrate: Adjust the `NavbarComponent` and walk through the changes, showing how we can navigate to different views:

```html
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" routerLink="/">E-Commerce!</a>
  <a class="navbar-brand" routerLink="/admin">Admin</a>
  <a class="navbar-brand" routerLink="/items">Items</a>
</nav>
```

  * Mention the `/` as well, which due to our empty/default route configuration, will redirect to `items`

### Students Do: Add `NavbarComponent` Anchor Tags with `routerLink`s( 10 min )

File(s): `02-activities/06-stu_router_links/README.md`

* Add anchor tags with `routerLink`s to the `navbar.component.html`

### Instructor Do: `routerLinkActive` ( 5 min )

File(s): `02-activities/07-inst_active_link`

* Discuss how Angular allows us to apply a custom css class based on whether a route is active

* Add to the `navbar.component.html`:

```html
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" routerLink="/">E-Commerce!</a>
  <a class="navbar-brand" routerLink="/admin" routerLinkActive="link-active">Admin</a>
  <a class="navbar-brand" routerLink="/items" routerLinkActive="link-active">Items</a>
</nav>
```

```scss
// `navbar.component.scss`

.link-active {
    font-weight: bold;
}

```

* Demonstrate how when the route is active, the custom CSS class will be applied, and thus the `<a>` will be bolded.

### Partner Do: `routerLinkActive` ( 5 min )

File(s): `02-activities/08-stu_active_link/README.md`

Instructions:

1. Add the routerLinkActive property to each navbar link
1. Add a font-weight of bold to routerLinkActive

---

## Lunch (60 mins)

---

## Dynamic Routes (45 minutes)

### Instructor Do: Route Parameters ( 15 min )

File(s): `02-activities/09-inst_route_params`

* Note: For the sake of today's app, we'll be adjusting the app to access an item by *index*, not by ID. This is because our app currently randomly generates a new ID each time; we could mock this out better, but really it'll be done by the database/server, so it's not worth spending time on and just using the index will save time.

* Refer to/Send out: https://angular.io/guide/router#route-parameters

* Discuss/Lecture

  * Thus far, we've worked with static routes, such as `items`. However, what if we want to dynamically use a route to access a specific item? Introduce Route Parameters.

  * For example, we have all items, but what if we want to access a specific route by an ID?

  * Add to `app-routing.module.ts`:

  ``` ts
  { path: 'items/:itemIndex', component: ItemDetailComponent }
  ```

  * The colon `:` is used to designate a *route parameter*. In this case we are only adding *one* route parameter. Multiple can be used, such as `items/:department/:category/:itemId`, but we'll start with just one for now.

  * Add boilerplate `ItemDetailComponent` code, mostly copied from the `ItemCardComponent`.

  * Also declare an `item` property on `item-detail.component.ts`

```html
<!-- `item-detail.component.html` -->

<div class="container">
  <div class="row">
    <div class="col-12">

      <div class="card">
        <img class="card-img-top" *ngIf="item?.imageUrl" [src]="item?.imageUrl" alt="Card image cap" height="100">

        <div class="card-body">
          <h5 class="card-title"> Title</h5>
          <h5 class="card-title"> {{item?.name}}</h5>
          <p class="card-text">
            {{item?.description}}
          </p>
          <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>

      </div>

    </div>
  </div>

</div>
```

  * When `items/3` (or anything else after `items/`), the `ItemDetailComponent` is rendered.

### Partners Do: `ItemDetailComponent` Route ( 5-10 min )

File(s): `02-activities/10-stu_route_params/README.md`

* Instructor: Send out the above boilerplate code for `ItemDetailComponent`

Instructions:

1. Add a new route with `items/:itemIndex` and have it render the `ItemDetailComponent`.

### Instructor Do: Access Route Parameters in the Component ( 10 min )

File(s): `02-activities/11-inst_params_component`

* Note: The docs here use an observable `pipe` with `switchMap`, but that's arguably overkill for just beginning

* Adjust `ngOnInit` for `ItemDetailComponent`

```typescript
import { ParamMap, ActivatedRoute } from '@angular/router';

  constructor(
    private route: ActivatedRoute,
    
  ) { }

  paramSub: Subscription;

  ngOnInit() {
    this.paramSub = this.route.paramMap.subscribe(
      (paramMap: ParamMap) => {
        console.log('paramMap itemIndex', paramMap.get('itemIndex'));
        const itemIndex = +paramMap.get('itemIndex');

      })
  }
```

  * Refresh the students on how `subscribe` works

    * Unlike a promise with just 2 possible results (data and error), Observables have 3 results: data, error, and completion

    * We must unsubscribe (we aren't yet, but will add it); even if the component is destroyed, the subscription remains if we don't call `unsubscribe` on it (noted below)

  * `ParamMap` is imported from the `@angular/router` package.

  * `paramMap.get()` is the standard way to access a parameter instead of a JSON property accessor. In the above code, we `get('itemIndex)`, which gives us the `itemIndex` that was passed in the URL

  * Add a few console logs to demonstrate this

  * Note that all parameters are, by default, *strings* since they are typed in an address bar. We add the `+` above to convert our numerical string param to a number.

### Partner Do: Get Route Parameters ( 10 min )

File(s): `02-activities/12-stu_params_component`

* Replicate the above to get the route parameters in the `ItemDetailComponent`

---

## Break (5 mins)

---

## Display Item Detail, More `routerLink`s, Wrap-Up (45 minutes)

### Instructor Do: Item Detail Display ( 10 min )

File(s): `02-activities/`

* The app now needs a way to display a single item on the `ItemDetailComponent`.

* Add to `items.service.ts` and walkthrough the code:

```typescript
// items.service.ts

 getItemByIndex(index: number): Item | null {
    if (this.items[index]) {
      return this.items[index]
    } else {
      return null;
    }
  }
```

* Note the `:Item | null`: This designates that the function will either return an `Item` or `null`

* Hook this function up to the `ItemDetailComponent`:

```typescript
// item-detail.component.ts

import { Item, ItemsService } from '../shared/items.service';

item: Item;

  constructor(
    private route: ActivatedRoute,
    private itemsService: ItemsService
  ) { }


 ngOnInit() {
    console.log('route', this.route);
    this.paramSub = this.route.paramMap.subscribe(
      (paramMap: ParamMap) => {
        console.log('paramMap itemIndex', paramMap.get('itemIndex'));
        const itemIndex = +paramMap.get('itemIndex');
        this.item = this.itemsService.getItemByIndex(itemIndex)
        console.log('received item', this.item);

      })
  }
```

* Demonstrate how when going to `localhost:4200/items/1`, this will now render item of index 1 from the `items: Item[]` in the `ItemsService`

### Partner Do: Show the Item Detail ( 10 min )

File(s): `02-activities/14-stu_access_route/README.md`

Instructions:

Start by altering your `items.service.ts` file and adding the getItemByIndex method.

Then inside of `item-detail.component.ts` edit your `ngOnInit` method so that it utilizes itemIndex.

### Instructor Do: Adjust `routerLink`s in `ItemsMasterComponent` ( 5-10 min )

File(s): `02-activities/15-inst_routerLink`

* Mention how we want to able to click on an Item Card and have it navigate to the Item's Details

* Adjust the `item-card.component.html`:

```html
  <a [routerLink]="[i]" class="btn btn-primary">Open Details</a>
```

* When using `[routerLink]` binding on the routerLink, it requires an array of strings (reason being that you can pass in a bunch of both static and dynamic strings, and Angular will generate the URL for you)

* For this though, we are only adding 1 *relative* link - it is *not an absolute link because there are no `/` prefixes.* **Thus, if we are on `localhost:4200/items`, when the first item is clicked, it will navigate to `localhost:4200/items/0`**


### Students Do: Show the Item Detail ( 10 min )

File(s): `02-activities/16-stu_routerLink/README.md`

* Create the button that when clicked on, a card's button will navigate to the Item's Detail screen


### Instructor Do: Review ( 5 min )

File(s): `02-activities/16-stu_routerLink/solved`

* Recap all of the above and walk through the completed app

* If time permits, briefly cover how the app requires adjusting for deleting an item from the `AdminComponent`:

File(s): `02-activities/17-inst_delete_refactor/complete`

```typescript
// `admin.component.ts`
  onDeleteItem(i: number) {
    this.itemsService.deleteItemByIndex(i);
    this.getItems();
  }
```

```html
<!-- `admin.component.html` -->
<button class="btn btn-danger float-right" (click)="onDeleteItem(i)">X</button>
```

```typescript
// `items.service.ts`
 deleteItemByIndex(index: number) {
    this.items.splice(index, 1);
    console.log('deleted item! Remaining items:', this.items)
  }
```
---